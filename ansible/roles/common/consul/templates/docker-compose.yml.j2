# ansible/roles/common/consul/templates/docker-compose.yml.j2
---
version: '3.8'

services:
  consul:
    image: hashicorp/consul:${CONSUL_VERSION:-1.16.0}
    container_name: consul
    restart: unless-stopped
    volumes:
      - ${CONSUL_DATA_DIR:-/opt/consul}:/consul/data
      - ${CONSUL_CONFIG_DIR:-/etc/consul.d}:/consul/config
    ports:
      - "${CONSUL_HTTP_PORT:-8500}:8500"
      - "${CONSUL_DNS_PORT:-8600}:8600/tcp"
      - "${CONSUL_DNS_PORT:-8600}:8600/udp"
    environment:
      - CONSUL_ALLOW_PRIVILEGED_PORTS=true
    command: >
      agent -server -ui
      -bootstrap-expect=1
      -client=0.0.0.0
      -datacenter=${CONSUL_DATACENTER:-dc1}
      -domain=${CONSUL_DOMAIN:-consul}
    networks:
      - traefik_network

networks:
  traefik_network:
    external: true