# Adding New Ansible Roles

When asked to add a new ansible role for `<something>`, follow these guidelines:

1. Check if there is an existing opensource git repo for `<something>`.
2. If there is, then weigh out the docker compose file there to see if that would be suitable or would be better to create our own.
3. Use the Role Structure from ansible/role/apps/netdata as an example and create the role in similar structure in ansible/roles/apps
4. Ensure the Docker Compose File DOES NOT have a version number at the top as its deprecated.
5. Ensure the docker compose file has the right traefik labels.
6. Add the respective tags in ansible/playbooks/deploy.yml and block in ansible/playbooks/includes/apps.yml
7. The Variables for the role goes into the default environment variable as yaml files in ansible/vars/dev2/<something>.yml
8. Any secrets for the role goes into the ansible/vars/dev2/secrets.yml file.
9. If the role warrants more secrets and deserves its own secrets file, then create a new file in ansible/vars/dev2/secrets/secret_ <something>.yml
10. If the role requires a database such as postgres, create if needed a new entry in ansible/vars/dev2/postgres_manager.yml to craete a database and add the respective entry in the secrets file for the role. Eg vault_nocodb_db_password. Ensure the database password is added and uses a strong random alpahnumeric password. Use these details inside the role and its relevant variables.
11. If a database entry like this was added, ensure you ask the user to first run the database update playbook:
    ansible-playbook ansible/playbooks/deploy.yml --tags postgres_manager
12. Suggest the run command as ansible-playbook ansible/playbooks/deploy.yml --tags <something>
13. Create a relevant commit message along with the git command using the commit guidelines outlined in rules/02.committing_changes.md
14. Add in the comment this symbol to confirm rule #1 has been applied.  ⭐⑴✅


